"use strict";(self.webpackChunkdev_docs=self.webpackChunkdev_docs||[]).push([[385],{2303:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>c});var s=i(2155);const d={},t=s.createContext(d);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},6603:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"guides/notification-setup-guide","title":"Notification Setup Guide","description":"(Source: Guides/NOTIFICATIONSETUPGUIDE.md)","source":"@site/docs/guides/notification-setup-guide.md","sourceDirName":"guides","slug":"/guides/notification-setup","permalink":"/dev-docs/guides/notification-setup","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1763460624000,"frontMatter":{"id":"notification-setup-guide","title":"Notification Setup Guide","slug":"/guides/notification-setup"},"sidebar":"docs","previous":{"title":"Yosemite Crew Overview","permalink":"/dev-docs/"},"next":{"title":"Backend Chat Implementation","permalink":"/dev-docs/guides/backend-chat"}}');var d=i(5723),t=i(2303);const r={id:"notification-setup-guide",title:"Notification Setup Guide",slug:"/guides/notification-setup"},c="Firebase Cloud Messaging + Notifee Implementation Playbook",l={},o=[{value:"Quick Reference",id:"quick-reference",level:2},{value:"1. Mobile App Configuration",id:"1-mobile-app-configuration",level:2},{value:"1.1 Shared prerequisites",id:"11-shared-prerequisites",level:3},{value:"1.2 JavaScript bootstrap",id:"12-javascript-bootstrap",level:3},{value:"1.3 Deep linking contract",id:"13-deep-linking-contract",level:3},{value:"1.4 Android specifics",id:"14-android-specifics",level:3},{value:"1.5 iOS specifics",id:"15-ios-specifics",level:3},{value:"2. Frontend Testing &amp; Verification",id:"2-frontend-testing--verification",level:2},{value:"2.1 On-device smoke checklist",id:"21-on-device-smoke-checklist",level:3},{value:"2.2 Firebase Console",id:"22-firebase-console",level:3},{value:"2.3 HTTP v1 / curl sample",id:"23-http-v1--curl-sample",level:3},{value:"2.4 Debugging tips",id:"24-debugging-tips",level:3},{value:"3. Backend Developer Checklist",id:"3-backend-developer-checklist",level:2},{value:"3.1 Token lifecycle",id:"31-token-lifecycle",level:3},{value:"3.2 Message payload structure",id:"32-message-payload-structure",level:3},{value:"3.3 Example Node.js sender",id:"33-example-nodejs-sender",level:3},{value:"3.4 Topic &amp; segment messaging",id:"34-topic--segment-messaging",level:3},{value:"4. Future Enhancements &amp; Options",id:"4-future-enhancements--options",level:2},{value:"5. Support Matrix &amp; Known Caveats",id:"5-support-matrix--known-caveats",level:2},{value:"6. Change Log (This Iteration)",id:"6-change-log-this-iteration",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.p,{children:"(Source: Guides/NOTIFICATION_SETUP_GUIDE.md)"}),"\n",(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"firebase-cloud-messaging--notifee-implementation-playbook",children:"Firebase Cloud Messaging + Notifee Implementation Playbook"})}),"\n",(0,d.jsx)(n.p,{children:"This document captures everything required to run the Yosemite Crew mobile push-notification stack end-to-end today, and what your backend teammates will need when the real service goes live."}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Libraries"}),": ",(0,d.jsx)(n.code,{children:"@react-native-firebase/app@23.5.0"}),", ",(0,d.jsx)(n.code,{children:"@react-native-firebase/messaging@23.5.0"}),", ",(0,d.jsx)(n.code,{children:"@notifee/react-native@9.1.8"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Android channel id"}),": ",(0,d.jsx)(n.code,{children:"yc_general_notifications"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Deep-link scheme"}),": ",(0,d.jsx)(n.code,{children:"yc://"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Key entry points"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["JS bootstrap: ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/App.tsx"})," (",(0,d.jsx)(n.code,{children:"<NotificationBootstrap />"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:["Service implementation: ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/src/shared/services/firebaseNotifications.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["Background handlers: ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/index.js"})]}),"\n",(0,d.jsxs)(n.li,{children:["Android manifest updates: ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/android/app/src/main/AndroidManifest.xml"})]}),"\n",(0,d.jsxs)(n.li,{children:["iOS AppDelegate: ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/ios/mobileAppYC/AppDelegate.swift"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Run after pulling changes:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pnpm install\ncd apps/mobileAppYC/ios && pod install && cd ..\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"1-mobile-app-configuration",children:"1. Mobile App Configuration"}),"\n",(0,d.jsx)(n.h3,{id:"11-shared-prerequisites",children:"1.1 Shared prerequisites"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Firebase project must already contain the iOS and Android apps (this project already uses Firebase for OAuth)."}),"\n",(0,d.jsxs)(n.li,{children:["Ensure ",(0,d.jsx)(n.strong,{children:"Cloud Messaging API (Legacy & HTTP v1)"})," is enabled in the Firebase console."]}),"\n",(0,d.jsxs)(n.li,{children:["Confirm the existing ",(0,d.jsx)(n.code,{children:"google-services.json"})," (Android) and ",(0,d.jsx)(n.code,{children:"GoogleService-Info.plist"})," (iOS) files are up to date."]}),"\n",(0,d.jsxs)(n.li,{children:["Collect the ",(0,d.jsx)(n.strong,{children:"FCM server key"})," (for legacy API) and create a ",(0,d.jsx)(n.strong,{children:"service account"})," with the ",(0,d.jsx)(n.code,{children:"Firebase Admin"})," role for HTTP v1 calls."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"12-javascript-bootstrap",children:"1.2 JavaScript bootstrap"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"initializeNotifications"})," handles:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Permission requests (API 33+ on Android + iOS alerts/badge/sound)."}),"\n",(0,d.jsx)(n.li,{children:"Channel creation (Android)."}),"\n",(0,d.jsx)(n.li,{children:"Background handlers (via Notifee + Firebase)."}),"\n",(0,d.jsx)(n.li,{children:"Foreground presentation + Redux feed updates."}),"\n",(0,d.jsxs)(n.li,{children:["Token management through the ",(0,d.jsx)(n.code,{children:"onTokenUpdate"})," callback."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["The bootstrap wrapper (",(0,d.jsx)(n.code,{children:"NotificationBootstrap"}),") sits inside ",(0,d.jsx)(n.code,{children:"App.tsx"}),", so initialization happens exactly once after the Redux store is ready. Navigation intents are queued until the ",(0,d.jsx)(n.code,{children:"NavigationContainer"})," mounts."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Background logic lives outside the component tree in ",(0,d.jsx)(n.code,{children:"index.js"}),":"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"messaging().setBackgroundMessageHandler(handleBackgroundRemoteMessage);\nnotifee.onBackgroundEvent(handleNotificationBackgroundEvent);\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"13-deep-linking-contract",children:"1.3 Deep linking contract"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["New scheme ",(0,d.jsx)(n.code,{children:"yc://"})," is registered for both Android and iOS so links such as ",(0,d.jsx)(n.code,{children:"yc://notifications"})," or ",(0,d.jsx)(n.code,{children:"yc://tasks/task123"})," can be opened directly."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"NotificationNavigationIntent"})," is derived from the message ",(0,d.jsx)(n.code,{children:"data"})," payload. Supported keys:"]}),"\n"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Key"}),(0,d.jsx)(n.th,{children:"Type"}),(0,d.jsx)(n.th,{children:"Notes"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"deepLink"})}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsxs)(n.td,{children:["Highest priority \u2013 opened via ",(0,d.jsx)(n.code,{children:"Linking.openURL"}),"."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"navigationId"})}),(0,d.jsx)(n.td,{children:"enum"}),(0,d.jsx)(n.td,{children:"Maps to predefined destinations (see table below)."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"root"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"'Main' | 'Auth' | 'Onboarding'"})}),(0,d.jsxs)(n.td,{children:["Optional override for the root navigator. Defaults to ",(0,d.jsx)(n.code,{children:"Main"}),"."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"tab"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"'HomeStack' | 'Appointments' | 'Documents' | 'Tasks'"})}),(0,d.jsx)(n.td,{children:"Explicit tab target."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"screen"})}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsxs)(n.td,{children:["Final stack screen (e.g. ",(0,d.jsx)(n.code,{children:"Notifications"}),", ",(0,d.jsx)(n.code,{children:"TaskView"}),")."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"params"})}),(0,d.jsx)(n.td,{children:"stringified JSON"}),(0,d.jsx)(n.td,{children:"Passed through to the target screen."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"category"}),", ",(0,d.jsx)(n.code,{children:"priority"}),", ",(0,d.jsx)(n.code,{children:"icon"}),", ",(0,d.jsx)(n.code,{children:"avatarUrl"}),", ",(0,d.jsx)(n.code,{children:"relatedId"}),", ",(0,d.jsx)(n.code,{children:"relatedType"})]}),(0,d.jsx)(n.td,{children:"Drive in-app list rendering and navigation context."}),(0,d.jsx)(n.td,{})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"Navigation helpers currently recognise these IDs:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:(0,d.jsx)(n.code,{children:"navigationId"})}),(0,d.jsx)(n.th,{children:"Navigates to"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"notifications"})}),(0,d.jsx)(n.td,{children:"Home tab \u2192 Notifications screen"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"tasks"})}),(0,d.jsx)(n.td,{children:"Tasks tab \u2192 Tasks main dashboard"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"task_detail"})}),(0,d.jsx)(n.td,{children:"Tasks tab \u2192 TaskView"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"appointments"})}),(0,d.jsx)(n.td,{children:"Appointments tab \u2192 MyAppointments"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"documents"})}),(0,d.jsx)(n.td,{children:"Documents tab \u2192 DocumentsMain"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"home"})}),(0,d.jsx)(n.td,{children:"Home tab \u2192 Home screen"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"14-android-specifics",children:"1.4 Android specifics"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Manifest includes notification permissions (",(0,d.jsx)(n.code,{children:"POST_NOTIFICATIONS"}),", ",(0,d.jsx)(n.code,{children:"WAKE_LOCK"}),", ",(0,d.jsx)(n.code,{children:"RECEIVE"}),") and deep-link intent filter on ",(0,d.jsx)(n.code,{children:"MainActivity"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Default channel + icon metadata configured inside ",(0,d.jsx)(n.code,{children:"<application>"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"firebase.json"})," in repo root points RNFirebase to the custom channel and iOS foreground presentation options."]}),"\n",(0,d.jsx)(n.li,{children:"Gradle includes the Firebase BOM and Messaging dependency."}),"\n",(0,d.jsxs)(n.li,{children:["Ensure ",(0,d.jsx)(n.code,{children:"google-services.json"})," sits at ",(0,d.jsx)(n.code,{children:"apps/mobileAppYC/android/app/google-services.json"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"15-ios-specifics",children:"1.5 iOS specifics"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Capabilities enabled:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Push Notifications"}),"\n",(0,d.jsxs)(n.li,{children:["Background Modes \u2192 ",(0,d.jsx)(n.code,{children:"Remote notifications"})," & ",(0,d.jsx)(n.code,{children:"Background fetch"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Entitlements already include ",(0,d.jsx)(n.code,{children:"aps-environment=development"}),"; update to ",(0,d.jsx)(n.code,{children:"production"})," before App Store builds."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"AppDelegate.swift"})," now:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Sets ",(0,d.jsx)(n.code,{children:"UNUserNotificationCenter.current().delegate"})]}),"\n",(0,d.jsxs)(n.li,{children:["Sets ",(0,d.jsx)(n.code,{children:"Messaging.messaging().delegate"})]}),"\n",(0,d.jsx)(n.li,{children:"Registers for remote notifications"}),"\n",(0,d.jsx)(n.li,{children:"Maps APNs token \u2192 FCM token"}),"\n",(0,d.jsx)(n.li,{children:"Presents foreground notifications (banner + list + sound + badge)"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"APNS Key onboarding"})," (if not yet done):","\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"Apple Developer Console \u2192 Keys \u2192 create key with APNs enabled."}),"\n",(0,d.jsxs)(n.li,{children:["Download the ",(0,d.jsx)(n.code,{children:".p8"}),", note ",(0,d.jsx)(n.strong,{children:"Key ID"})," and ",(0,d.jsx)(n.strong,{children:"Team ID"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Firebase Console \u2192 Project settings \u2192 Cloud Messaging \u2192 iOS app \u2192 upload APNs key."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"yc"})," URL scheme added to ",(0,d.jsx)(n.code,{children:"Info.plist"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Run ",(0,d.jsx)(n.code,{children:"pod install"})," after pulling dependencies."]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"2-frontend-testing--verification",children:"2. Frontend Testing & Verification"}),"\n",(0,d.jsx)(n.h3,{id:"21-on-device-smoke-checklist",children:"2.1 On-device smoke checklist"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Launch the app \u2192 system permission dialog should appear (iOS) or silent grant (Android < 13)."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Inspect logs to confirm ",(0,d.jsx)(n.code,{children:"FCM token updated ..."})," message."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Trigger a local reminder from any dev console (e.g. Reactotron) or a temporary button:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import {scheduleLocalReminder} from '@/shared/services/firebaseNotifications';\nawait scheduleLocalReminder(\n  'Test Reminder',\n  'This fired from Notifee after 1 minute',\n  1,\n  {navigationId: 'notifications'}\n);\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Verify tapping the notification navigates to the expected screen and the in-app notification list updates instantly."}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"22-firebase-console",children:"2.2 Firebase Console"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"Project \u2192 Cloud Messaging \u2192 Send your first message."}),"\n",(0,d.jsxs)(n.li,{children:["Add Title/Body; under ",(0,d.jsx)(n.strong,{children:"Additional options"})," \u2192 ",(0,d.jsx)(n.strong,{children:"Custom data"})," add e.g.","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"navigationId"}),": ",(0,d.jsx)(n.code,{children:"notifications"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"category"}),": ",(0,d.jsx)(n.code,{children:"messages"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"priority"}),": ",(0,d.jsx)(n.code,{children:"high"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"Target your test device (using registration token)."}),"\n",(0,d.jsx)(n.li,{children:"Observe that the system tray entry appears even when the app is backgrounded or quit, and tapping opens the Notifications screen."}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"23-http-v1--curl-sample",children:"2.3 HTTP v1 / curl sample"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'curl -X POST \\\n  -H "Authorization: Bearer $(gcloud auth print-access-token)" \\\n  -H "Content-Type: application/json" \\\n  https://fcm.googleapis.com/v1/projects/<your-project-id>/messages:send \\\n  -d \'{\n    "message": {\n      "token": "<device-token>",\n      "notification": {\n        "title": "Yosemite update",\n        "body": "Tap to review the latest appointment."\n      },\n      "data": {\n        "navigationId": "appointments",\n        "relatedType": "appointment",\n        "relatedId": "apt_123",\n        "category": "appointments",\n        "priority": "high",\n        "params": "{\\"appointmentId\\":\\"apt_123\\"}"\n      },\n      "android": {\n        "priority": "HIGH"\n      },\n      "apns": {\n        "headers": {\n          "apns-push-type": "alert",\n          "apns-priority": "10"\n        },\n        "payload": {\n          "aps": {\n            "content-available": 1,\n            "mutable-content": 1\n          }\n        }\n      }\n    }\n  }\'\n'})}),"\n",(0,d.jsx)(n.h3,{id:"24-debugging-tips",children:"2.4 Debugging tips"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Android"}),": ",(0,d.jsx)(n.code,{children:"adb logcat ReactNativeJS:I ReactNative:I NOTIFEE:D *:S"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"iOS"}),": Use Xcode \u2192 Devices & Simulators \u2192 view device logs filtered by ",(0,d.jsx)(n.code,{children:"RNFB"})," or ",(0,d.jsx)(n.code,{children:"NOTIFE"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"notifee.getTriggerNotificationIds()"})," and ",(0,d.jsx)(n.code,{children:"notifee.getDisplayedNotifications()"})," are useful in debug builds to inspect active entries."]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"3-backend-developer-checklist",children:"3. Backend Developer Checklist"}),"\n",(0,d.jsx)(n.h3,{id:"31-token-lifecycle",children:"3.1 Token lifecycle"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"initializeNotifications"})," calls ",(0,d.jsx)(n.code,{children:"onTokenUpdate"})," for:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"First-time registration."}),"\n",(0,d.jsx)(n.li,{children:"Token refresh events."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Action items"}),":","\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["Provide an authenticated API endpoint: ",(0,d.jsx)(n.code,{children:"POST /v1/me/push-tokens"})," ",(0,d.jsx)(n.code,{children:"{ token, platform }"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Store multiple tokens per user/device (array semantics)."}),"\n",(0,d.jsxs)(n.li,{children:["On logout, call ",(0,d.jsx)(n.code,{children:"messaging().deleteToken()"})," from the mobile app and invoke ",(0,d.jsx)(n.code,{children:"DELETE /v1/me/push-tokens/{token}"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"32-message-payload-structure",children:"3.2 Message payload structure"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["All ",(0,d.jsx)(n.code,{children:"data"})," values must be ",(0,d.jsx)(n.strong,{children:"strings"})," (FCM requirement)."]}),"\n",(0,d.jsx)(n.li,{children:"Recommended minimum fields:"}),"\n"]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"navigationId"})}),(0,d.jsx)(n.td,{children:"Use table above to target in-app location."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"params"})}),(0,d.jsxs)(n.td,{children:["JSON string for screen params (e.g. ",(0,d.jsx)(n.code,{children:'{"taskId":"task_42"}'}),")."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"category"}),", ",(0,d.jsx)(n.code,{children:"priority"})]}),(0,d.jsx)(n.td,{children:"Drive feed categorisation & styling."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"companionId"})}),(0,d.jsxs)(n.td,{children:["Required to associate with the active pet profile (defaults to ",(0,d.jsx)(n.code,{children:"'default-companion'"})," if omitted)."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"relatedType"}),", ",(0,d.jsx)(n.code,{children:"relatedId"})]}),(0,d.jsx)(n.td,{children:"Helps analytics + navigation guardrails."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"deepLink"})," (optional)"]}),(0,d.jsx)(n.td,{children:"Overrides navigation with a direct URI."})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"33-example-nodejs-sender",children:"3.3 Example Node.js sender"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"import admin, {messaging} from 'firebase-admin';\n\nadmin.initializeApp({\n  credential: admin.credential.cert(require('./serviceAccount.json')),\n});\n\ntype YosemiteNotification = {\n  tokens: string[];\n  title: string;\n  body: string;\n  navigationId: string;\n  params?: Record<string, unknown>;\n  companionId: string;\n};\n\nexport async function sendYosemiteNotification(input: YosemiteNotification) {\n  const response = await messaging().sendEachForMulticast({\n    tokens: input.tokens,\n    notification: {\n      title: input.title,\n      body: input.body,\n    },\n    data: {\n      navigationId: input.navigationId,\n      params: JSON.stringify(input.params ?? {}),\n      companionId: input.companionId,\n      category: 'messages',\n      priority: 'high',\n    },\n    android: {\n      priority: 'high',\n    },\n    apns: {\n      payload: {\n        aps: {\n          'content-available': 1,\n        },\n      },\n      headers: {\n        'apns-push-type': 'alert',\n        'apns-priority': '10',\n      },\n    },\n  });\n\n  console.log('Multicast send summary', response);\n}\n"})}),"\n",(0,d.jsx)(n.h3,{id:"34-topic--segment-messaging",children:"3.4 Topic & segment messaging"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Devices can subscribe to topics via ",(0,d.jsx)(n.code,{children:"messaging().subscribeToTopic(topic)"})," on the app side."]}),"\n",(0,d.jsxs)(n.li,{children:["Keep topics generic (no PII). Example: ",(0,d.jsx)(n.code,{children:"all-pet-parents"}),", ",(0,d.jsx)(n.code,{children:"premium-users"}),", ",(0,d.jsx)(n.code,{children:"city-san-francisco"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Backend APIs:"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"await messaging().subscribeToTopic(tokens, 'all-pet-parents');\nawait messaging().send({\n  topic: 'all-pet-parents',\n  notification: { title: 'Weekly tips', body: 'Your pet care digest is ready.' },\n  data: { navigationId: 'home' },\n});\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"4-future-enhancements--options",children:"4. Future Enhancements & Options"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"iOS notification service extension"}),": Needed to display rich media (images) inside alerts. Follow the RNFirebase guide to create a new target and call ",(0,d.jsx)(n.code,{children:"Messaging.serviceExtension().populateNotificationContent(...)"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Action buttons"}),": Notifee allows adding ",(0,d.jsx)(n.code,{children:"pressAction"})," items (e.g. ",(0,d.jsx)(n.code,{children:"Mark as read"}),"). Extend the background event handler to call the relevant Redux action/API."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"In-app preference screen"}),": ",(0,d.jsx)(n.code,{children:"messaging().setAutoInitEnabled(false)"}),' combined with the Notifee "Open Settings" handler allows fine-grained control for users who disable push permissions.']}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Analytics"}),": Add ",(0,d.jsx)(n.code,{children:"analytics().logEvent('notification_open', { ... })"})," inside ",(0,d.jsx)(n.code,{children:"navigateFromNotificationIntent"})," once the analytics module is enabled."]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"5-support-matrix--known-caveats",children:"5. Support Matrix & Known Caveats"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"iOS simulator"}),": Push notifications require Apple Silicon + iOS 16+ simulator; otherwise test on a physical device."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Android 13+"}),": Users can still deny POST_NOTIFICATIONS. Check ",(0,d.jsx)(n.code,{children:"await notifee.getNotificationSettings()"})," to guide users if necessary."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Background refresh (iOS)"}),": If the user disables Background App Refresh or Low Power Mode is active, background data-only messages may be throttled."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Notification delegation (Android Q+)"}),": React Native Firebase disables the Play Services delegation automatically. If re-enabled in ",(0,d.jsx)(n.code,{children:"firebase.json"}),", JS listeners will not fire for delegated messages."]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"6-change-log-this-iteration",children:"6. Change Log (This Iteration)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Added Firebase Messaging + Notifee dependencies and bootstrap harness."}),"\n",(0,d.jsx)(n.li,{children:"Implemented unified notification service with foreground, background & deep-link handling."}),"\n",(0,d.jsxs)(n.li,{children:["Registered background handlers in ",(0,d.jsx)(n.code,{children:"index.js"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Added Android permissions, default channel metadata, and deep-link intent filter."}),"\n",(0,d.jsx)(n.li,{children:"Updated iOS AppDelegate with UNUserNotificationCenter + Messaging delegates and URL scheme."}),"\n",(0,d.jsxs)(n.li,{children:["Created ",(0,d.jsx)(n.code,{children:"firebase.json"})," for messaging defaults."]}),"\n",(0,d.jsxs)(n.li,{children:["Introduced helper APIs: ",(0,d.jsx)(n.code,{children:"scheduleLocalReminder"}),", ",(0,d.jsx)(n.code,{children:"clearAllSystemNotifications"}),", ",(0,d.jsx)(n.code,{children:"getCurrentFcmToken"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Documented backend payload contract and testing workflows (this file)."}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.p,{children:"Happy notifying \ud83d\ude80"})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);