<p align="center">
  <a href="https://yosemitecrew.com/">
    <img src="https://d2il6osz49gpup.cloudfront.net/YC.svg" width="150px" alt="Yosemite Crew Logo" />
  </a>
</p>

<h1 align="center">Yosemite Crew Mobile App</h1>

<div align="center">

[![React Native 0.81.4](https://img.shields.io/badge/React%20Native-0.81.4-61DAFB?logo=react)](https://reactnative.dev)
[![PNPM](https://img.shields.io/badge/pnpm-F69220?logo=pnpm)](https://pnpm.io)
[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?logo=typescript)](https://www.typescriptlang.org/)
[![Contributing](https://img.shields.io/badge/Contribute-FF9800)](https://github.com/YosemiteCrew/Yosemite-Crew/blob/main/CONTRIBUTING.md)

</div>

---

This directory contains the React Native mobile application for the **Yosemite Crew** open-source operating system for animal health. This app serves as the primary interface for pet owners to connect with veterinary clinics and manage their pet's health.

## üõ†Ô∏è Getting Started

This guide will walk you through setting up the mobile app on your local machine for development.

### Prerequisites

-   **Node.js**: Version `20` or higher.
-   **pnpm**: Ensure you have `pnpm` installed globally.
-   **React Native Environment**: You **must** complete the official setup guide for your OS and target platform (Android/iOS). Follow the instructions under the "**React Native CLI Quickstart**" tab.
    -   [**React Native Environment Setup Guide**](https://reactnative.dev/docs/set-up-your-environment)
-   **Ruby and Bundler**: Required for managing iOS dependencies (CocoaPods).
-   **AWS Account & IAM User**: An active AWS account is required to run the backend.

---

### Step 1: Configure Your AWS Credentials

Before you begin, the AWS Amplify CLI needs credentials to deploy resources to your AWS account.

1.  **Create an IAM User**: In your AWS account, create a new IAM user with **AdministratorAccess**.
2.  **Get Access Keys**: Generate an **Access Key ID** and a **Secret Access Key**.
3.  **Configure Your Local Machine**: Configure the AWS CLI on your machine by running `aws configure` and providing the keys you generated. The Amplify CLI uses these credentials automatically.

```sh
# Install the AWS CLI if you haven't already
# Then, configure it with your IAM user credentials
aws configure
AWS Access Key ID [None]: YOUR_ACCESS_KEY_ID
AWS Secret Access Key [None]: YOUR_SECRET_ACCESS_KEY
Default region name [None]: us-east-1
Default output format [None]: json
````

-----

### Step 2: Install Monorepo Dependencies

Navigate to the **root** of the entire `Yosemite-Crew` monorepo (not this folder) and install all project dependencies using `pnpm`.

```sh
# From the root of the Yosemite-Crew project
pnpm install
```

-----

### Step 3: Set up AWS Amplify Sandbox

This project uses AWS Amplify for its backend. Run a local sandbox environment that connects to your configured AWS account.

1.  **Start the sandbox**. This will deploy a development backend to your AWS account.

    ```sh
    npx ampx sandbox
    ```

2.  **Set the required secrets**. You must have a **verified sender identity in Amazon SES** (Simple Email Service) for passwordless OTP emails to work.

    ```sh
    # Replace YOUR_VERIFIED_EMAIL@example.com with your verified SES email address
    npx ampx sandbox secret set PASSWORDLESS_OTP_EMAIL_FROM YOUR_VERIFIED_EMAIL@example.com

    # This secret is optional if you are not mocking a custom user service
    npx ampx sandbox secret set CUSTOM_USER_SERVICE_URL
    ```

3.  **Grant Email Permissions in AWS IAM**. The Cognito IAM role generated by the sandbox needs permission to send emails through SES.

      - Navigate to the **IAM console** in your AWS account.
      - Find the unauthenticated IAM role associated with your Cognito Identity Pool (its name will be similar to `amplify-....-unauth-role`).
      - Attach a new inline policy with the following JSON.

    <!-- end list -->

    ```json
    {
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Action": [
                    "ses:SendEmail",
                    "ses:SendRawEmail"
                ],
                "Resource": "arn:aws:ses:YOUR_AWS_REGION:YOUR_AWS_ACCOUNT_ID:identity/YOUR_VERIFIED_EMAIL@example.com"
            }
        ]
    }
    ```

    > **Important**: Replace the placeholder `Resource` ARN with the actual ARN of your verified SES identity.

-----

### Step 4: Configure Environment Credentials (Crucial\!)

To run the app, you need to provide your own credentials for various services. We provide example files that you must copy and fill in.

> **A Note on Environment Variables**: We are currently not using `react-native-config` due to instability with native file integration on React Native's New Architecture (Fabric). Therefore, configuration must be done directly in the native project files as described below.

#### A. JavaScript Variables

1.  Copy the example file:
    ```sh
    cp apps/mobileAppYC/src/config/variablesExample.ts apps/mobileAppYC/src/config/variables.ts
    ```
2.  Open `apps/mobileAppYC/src/config/variables.ts` and replace the placeholder values.

#### B. Android Native Configuration

1.  **Firebase**: Download your `google-services.json` file from Firebase and place it in the `android/app/` directory.
2.  **Other Keys**: Copy the sample `strings.xml` file:
    ```sh
    cp docs/android/app/src/main/res/values/stringsXml\(Example\).txt android/app/src/main/res/values/strings.xml
    ```
3.  Open `android/app/src/main/res/values/strings.xml` and fill in all the required values.

#### C. iOS Native Configuration

1.  **Firebase**: Download your `GoogleService-Info.plist` file from Firebase. Place it in `apps/mobileAppYC/ios/mobileAppYC/` and **add it to the project using Xcode**.
2.  **Other Keys**: Copy the sample `Info.plist` file:
    ```sh
    cp docs/ios/mobileAppYC/Infoplist\(Example\).txt apps/mobileAppYC/ios/mobileAppYC/Info.plist
    ```
3.  Open `apps/mobileAppYC/ios/mobileAppYC/Info.plist` and input your keys where indicated.

-----

### Step 5: Update Application Identifiers

For a clean build, change the default package name (Android) and bundle identifier (iOS).

  - **Android**: In `android/app/build.gradle`, change the `applicationId` from `"com.mobileappyc"` to your own. Also, refactor the directory structure under `android/app/src/main/java/` to match.
  - **iOS**: In Xcode, open `apps/mobileAppYC/ios/mobileAppYC.xcworkspace`, go to the "General" tab, and change the **Bundle Identifier**.

-----

### Step 6: Run The Application

All commands below should be run from this directory (`apps/mobileAppYC`).

#### 1\. Start the Metro Server

Open a terminal and keep it running.

```sh
# Using pnpm
pnpm start
```

#### 2\. Build for Android or iOS

Open a **new** terminal window.

##### ‚ñ∂Ô∏è Android

```sh
pnpm run android
```

##### ‚ñ∂Ô∏è iOS

```sh
# Navigate to the iOS directory to install pods
cd ios
bundle install
bundle exec pod install
cd ..

# Run the app
pnpm run ios
```

If everything is set up correctly, you should see the app running. ‚ú®

-----

## üêõ Troubleshooting

If you encounter any issues, please refer to the official documentation first:

  - [React Native Troubleshooting Guide](https://reactnative.dev/docs/troubleshooting)

## ‚ö†Ô∏è Known Issues

The following are known bugs that are expected to be resolved in future releases of React Native or related library dependencies.

  - **Issue 985: Android Fast Refresh not working reliably in Monorepo**
      - Link: [https://github.com/YosemiteCrew/Yosemite-Crew/issues/985](https://github.com/YosemiteCrew/Yosemite-Crew/issues/985)
  - **Issue 1053: iOS/Android Build Issue with Library Compatibility**
      - Link: [https://github.com/YosemiteCrew/Yosemite-Crew/issues/1053](https://github.com/YosemiteCrew/Yosemite-Crew/issues/1053)

-----

## üôå Contributing

We love contributions\! Please read our [**Contributing Guide**](https://github.com/YosemiteCrew/Yosemite-Crew/blob/main/CONTRIBUTING.md) to get started.
